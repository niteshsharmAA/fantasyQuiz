<%- include("../../partials/head") %>

    <%- include("../../partials/bodyStartWithNavBar/") %>
        <%- include("../../partials/sideNav") %>
            <div id="layoutSidenav_content">
                <main>

                    <div class="page-header pb-10 page-header-dark bg-info">
                        <div class="container-fluid">
                            <div class="row align-items-center">
                                <div class="col">
                                    <div class="page-header-content">
                                        <h1 class="page-header-title fs-md-35 fs-20">

                                            <div class="page-header-icon"><i class="fad fa-at text-white"></i></div>
                                            <span class=" text-capitalize">
                                                Stock Contest Manager
                                            </span>
                                        </h1>
                                        <div class="page-header-subtitle fs-md-19 fs-14 text-capitalize">
                                            Add stock contest
                                        </div>
                                    </div>
                                </div>
                                <div class="col-auto mb-md-0 mb-3">
                                    <a href="/viewStockContest"
                                        class="btn btn-sm btn-light font-weight-bold text-uppercase text-primary text-uppercase"><i
                                            class="fad fa-eye"></i>&nbsp; View All Global Contests</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <%- include("../../partials/alertMsg") %>
                        <div class="container-fluid mt-n10">
                            <div class="card">
                                <div class="card-header">Global Contest</div>
                                <form method="POST" action="/edit-stock-contest-data" class="card-body" enctype="multipart/form-data">
                                    <input type="hidden" name="stockContestsId" value="<%=getstockdata._id %>">
                                    <input type="hidden" name="typename" value="stockContest">
                                    <div class="sbp-preview">
                                        <div class="sbp-preview-content py-2">
                                            <div class="row mx-0">
                                                <div class="col-md-6">
                                                    
                                                    <div class="form-group my-3">
                                                        <label class="label-control text-bold fs-13">Contest Amount
                                                            Type*</label><br>
                                                        <div class="custom-control custom-radio custom-control-inline">
                                                            <input type="radio" id="customRadio1" name="contest_type"
                                                                value="Amount" <%=getstockdata.contest_type == 'Amount' ? 'checked' : '' %> checked class="custom-control-input">
                                                            <label class="custom-control-label"
                                                                for="customRadio1">Amount Based</label>
                                                        </div>
                                                        <div class="custom-control custom-radio custom-control-inline">
                                                            <input type="radio" name="contest_type" value="Percentage"
                                                                id="customRadio2" class="custom-control-input"<%=getstockdata.contest_type == 'Percentage' ? 'checked' : '' %>
                                                                value="specific">
                                                            <label class="custom-control-label"
                                                                for="customRadio2">Percentage based</label>
                                                        </div>
                                                    </div>
                                                   
                                                </div>
                                                <div class="col-md-6">
            
                                                    <div class="form-group my-3 fs-13" id="pricecard_contest">
                                                        <label class="label-control text-bold">Contest Price Card
                                                            Type*</label><br>
                                                        <div class="custom-control custom-radio custom-control-inline">
                                                            <input type="radio" name="pricecard_type" value="Amount"
                                                                id="customRadio11" class="custom-control-input"<%=getstockdata.pricecard_type == 'Amount' ? 'checked' : '' %>>
        
                                                            <label class="custom-control-label"
                                                                for="customRadio11">Amount Based</label>
                                                        </div>
                                                        <div class="custom-control custom-radio custom-control-inline">
                                                            <input type="radio" name="pricecard_type" value="Percentage"
                                                                id="customRadio12" class="custom-control-input" <%=getstockdata.pricecard_type == 'Percentage' ? 'checked' : '' %>
                                                                value="specific">
                                                            <label class="custom-control-label"
                                                                for="customRadio12">Percentage based</label>
                                                        </div>
                                                    </div>
                                                   
                                                </div>
                                                
                                                <div class="col-md-12">
                                                    <div class="form-group my-3">
                                                        <label class="label-control text-bold">Stock Contest Category*</label>
                                                        <select name="stock_contest_cat" class="form-control form-control-solid p-1 selectpicker show-tick"
                                                        required="" id="stock_contest_cat">
                                                           <%if(typeof getstockcontestcategory!=="undefined" && getstockcontestcategory){%>
                                                            <%for(let stockcategory of getstockcontestcategory){%>
                                                            <option value="<%= stockcategory.name%>" <%=getstockdata.stock_contest_cat === stockcategory.name ? 'selected' : '' %>><%= stockcategory.name%></option>
                                                            <%}%>
                                                           <%}%>
                                                        </select>
                                                    </div>
                                                </div>

                                                <div class="col-md-12">
                                                    <div class="form-group my-3">
                                                    <label class="label-control text-bold">Stock Category*</label>
                                                    <select name="stock_categoryId[]" class="form-control form-control-solid p-1 selectpicker show-tick"required="" id="stock_categoryId"multiple>
                                                     <%if(typeof stockcategory!=="undefined" && stockcategory){%>
                                                      <%for(let stockcat of stockcategory){%>
                                                      <option value="<%= stockcat._id%>" <%= getstockdata.stock_categoryId.includes(stockcat._id) ? 'selected' : '' %>><%= stockcat.name%></option>
                                                       <%}%>
                                                       <%}%>
                                                     </select>
                                                      </div>
                                                </div>

                                                <div class="col-md-12 col-12">
                                                    
                                                    <div class="form-group my-3">
                                                        <label class="label-control text-bold">Contest Name*</label>
                                                        <input type="text" placeholder="Enter Contest Name"
                                                            class="form-control form-control-solid" name="contest_name" value="<%=getstockdata.contest_name ? getstockdata.contest_name : '' %>"
                                                            required />
                                                    </div>
                                                    
                                                </div>
                                                <!-- <div class="col-md-6"> 
                                                    <div class="form-group my-3">
                                                        <label class="label-control text-bold fs-13">Amount
                                                            Type*</label><br>
                                                        <div class="custom-control custom-radio custom-control-inline">
                                                            <input type="radio" name="amount_type" <%=getstockdata.amount_type == 'price'? 'checked' : '' %> 
                                                                value="price" id="customRadio1_amount_type"
                                                                class="custom-control-input">
                                                            <label class="custom-control-label fs-15"
                                                                for="customRadio1_amount_type">Price</label>
                                                        </div>
                                                        <div class="custom-control custom-radio custom-control-inline">
                                                            <input type="radio" name="amount_type" <%=getstockdata.amount_type == 'prize'? 'checked' : '' %> value="prize"
                                                                id="customRadio2_amount_type"
                                                                class="custom-control-input">
                                                            <label class="custom-control-label fs-15"
                                                                for="customRadio2_amount_type">Prize</label>
                                                        </div>
                                                    </div>
                                                </div> -->
                                                <div class="col-md-6">
                                                    <div class="form-group my-3">
                                                        <label class="label-control text-bold">Entry Fee*</label>
                                                        <input type="number" onkeypress="return isNumberKey(event)" value='<%=getstockdata.entryfee %>'
                                                            id="first-name" min="0"
                                                            class="form-control form-control-solid"
                                                            placeholder="Enter Entry Fee" name="entryfee" value=""
                                                            required="" autocomplete="off">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group my-3">
                                                        <label class="label-control text-bold">Winning Amount*</label>
                                                        <input type="number" onkeypress="return isNumberKey(event)" value='<%=getstockdata.win_amount %>'
                                                            min="0" class="form-control form-control-solid"
                                                            placeholder="Enter Winning Amount" name="win_amount"
                                                            required="" value="" autocomplete="off">
                                                    </div> 
                                                </div>

                                                
                                                <div class="col-md-12">
                                                    
                                                    <div class="form-group my-3" id="max_user">
                                                        <label class="label-control text-bold">Maximum number of
                                                            users*</label>
                                                        <input type="number" onkeypress="return isNumberKey(event)" value='<%=getstockdata.maximum_user %>'
                                                            min="0" class="form-control form-control-solid"
                                                            placeholder="Enter Maximum Number Of Users"
                                                            name="maximum_user" autocomplete="off">
                                                    </div>
                                                    
                                                </div>
                                                <!-- <div class="col-md-6">
                                                  
                                                    <div class="form-group my-3">
                                                        <label class="label-control text-bold">start date*</label>
                                                        <input type="date" onkeypress="return isNumberKey(event)"
                                                            min="0" class="form-control form-control-solid"
                                                            placeholder="start date" name="start_date" value='<%=getstockdata.start_date %>'
                                                            required="" autocomplete="off">
                                                    </div>
                                                    
                                                </div>
                                                <div class="col-md-6">
                                    
                                                    <div class="form-group my-3" id="max_user">
                                                        <label class="label-control text-bold">end date*</label>
                                                        <input type="date" onkeypress="return isNumberKey(event)"
                                                            min="0" class="form-control form-control-solid"
                                                            placeholder="end date"
                                                            name="end_date"  value='<%=getstockdata.end_date %>' autocomplete="off">
                                                    </div>
                                                 
                                                </div> -->
    
                                                <div class="col-md-6 col-12">
                                                    <div class="form-group my-3">
                                                        <label for="example-datetime-local-input">Start Date*</label>
                                                        <input class="form-control form-control-solid" type="text" placeholder="Enter Start Date" id="example-datetime-local-input" autocomplete="off"  name="start_date" value='<%=getstockdata.start_date %>' required>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 col-12">
                                                    <div class="form-group my-3">
                                                        <label for="example-datetime-local-input2">End Date*</label>
                                                        <input class="form-control form-control-solid" type="text" placeholder="Enter End Date"  name="end_date" autocomplete="off" id="example-datetime-local-input2" value='<%=getstockdata.end_date %>' required>
                                                    </div>
                                                </div>
                                                <div class="col-md-12">
                                                  
                                                    <div class="form-group my-3" id="pert" style="display:none;">
                                                        <label class="label-control text-bold">Percentage of users who
                                                            will win (In case of
                                                            percentage)*</label>
                                                        <input type="number" onkeypress="return isNumberKey(event)"
                                                            disabled="" min="0" max="100" id="ch1"
                                                            class="form-control form-control-solid" min="0"
                                                            placeholder="Enter percentage of users winning this challenge"
                                                            name="winning_percentage" value='<%=getstockdata.winning_percentage %>' required=""
                                                            autocomplete="off">
                                                    </div>
                                                   
                                                </div>
                                                <div class="col-12 mt-3" id="team_limit" style="display:none">
                                                 
                                                    <div class="form-group">
                                                        <label class="label-control text-bold">Team Limit</label>
                                                        <input disabled="" id="ch21" type="number"
                                                            onkeypress="return isNumberKey(event)"
                                                            class="form-control form-control-solid" name="team_limit" value='<%=getstockdata.team_limit %>'
                                                            placeholder="Enter Team Limit" required="">
                                                    </div>
                                                    
                                                </div>

                                                <div class="col-md-3" id="cc">
                                                   
                                                    <!-- <div class="form-group my-3">
                                                        <div
                                                            class="custom-control custom-checkbox custom-control-inline">
                                                            <input type="checkbox" class="custom-control-input sel_all"
                                                                id="select_all1" name="confirmed_challenge"value="<%=getstockdata.confirmed_challenge %>" <%=getstockdata.confirmed_challenge == 1 ? 'checked': '' %>>
                                                            <label class="custom-control-label" for="select_all1">Is
                                                                Confirmed</label>
                                                        </div>
                                                    </div> -->
                                                    
                                                </div>
                                                <div class="col-md-3">
                                                   
                                                    <div class="form-group my-3">
                                                        <div
                                                            class="custom-control custom-checkbox custom-control-inline">
                                                            <input type="checkbox" class="custom-control-input sel_all"
                                                                id="select_all2" name="is_running" value="<%=getstockdata.is_running %>" <%=getstockdata.is_running == 1 ? 'checked': '' %>>
                                                            <label class="custom-control-label" for="select_all2">Is
                                                                Running</label>
                                                        </div>
                                                    </div>
                                                   
                                                </div>
                                                <div class="col-md-3">
                                                 
                                                    <div class="form-group my-3">
                                                        <div
                                                            class="custom-control custom-checkbox custom-control-inline">
                                                            <input type="checkbox" class="custom-control-input sel_all"
                                                                id="select_all3" name="is_bonus" value="<%=getstockdata.is_bonus %>" <%=getstockdata.is_bonus == 1 ? 'checked': '' %>>
                                                            <label class="custom-control-label" for="select_all3">Is
                                                                Bonus Allowed</label>
                                                        </div>
                                                    </div>
                                                   
                                                </div>
                                                <div class="col-12 mt-3">
                                                   
                                                    <div class="form-group d-none" id="bonuspercentage">
                                                        <label class="label-control text-bold">Bonus Percentage (No need
                                                            to enter % here. Just enter
                                                            number here)*</label>
                                                        <input disabled="" id="ch2" type="text" min="0" max="100"
                                                            class="form-control form-control-solid"
                                                            name="bonus_percentage" value="<%=getstockdata.bonus_percentage %>" <%=getstockdata.bonus_percentage  ? ' ': 'disabled=""' %>
                                                            placeholder="Enter Bonus Percentage" required="">
                                                    </div>
                                                   
                                                </div>

                                                <div class="col-12">
                                                    <div class="form-group">
                                                        <div class="row justify-content-center py-0">
                                                            <h1 class="fs-14 font-weight-bold text-center mt-3 col-12">
                                                                Image</h1>
                                                            <div class="avatar-upload col-auto position-relative">
                                                                <div
                                                                    class="avatar-edit position-absolute right-0px z-index-1 top-2px">
                                                                    <input type='file' name="image" id="image"
                                                                        accept=".png" class="imageUpload d-none" />
                                                                    <label
                                                                        class="d-grid w-40px h-40px mb-0 rounded-pill bg-white text-success fs-20 shadow pointer font-weight-normal align-items-center justify-content-center"
                                                                        for="image"><i
                                                                            class="fad fa-pencil"></i></label>
                                                                </div>
                                                                <div
                                                                    class="avatar-preview w-100px h-100px position-relative rounded-pill shadow">
                                                                    <% if(getstockdata.image) {%>
                                                                        <div class="w-100 h-100 rounded-pill"
                                                                            id="image-imagePreview"
                                                                            style="background-image: url('<%=getstockdata.image %>');">
                                                                        </div>
                                                                        <%}else{ %>
                                                                            <div class="w-100 h-100 rounded-pill"
                                                                                id="image-imagePreview"
                                                                                style="background-image: url(/uploadImage/defaultImage.jpg);">
                                                                            </div>
                                                                            <% }%>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-12 text-right mt-md-4 mb-md-2">
                                                    <button type="reset" class="btn btn-sm text-uppercase btn-warning"
                                                        onclick="window.location.href=window.location.href"><i
                                                            class="far fa-undo"></i>&nbsp;
                                                        Reset</a>
                                                        <button type="submit"
                                                            class=" btn btn-sm text-uppercase btn-success float-right ml-1"><i
                                                                class="far fa-check-circle"></i>&nbsp; Submit</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                            </div>
                            <script>
                                $('input[name=is_bonus]').change(function () {
                                    if ($('input[name=is_bonus]').prop('checked') == true) {
                                        $('input[name=bonus_percentage]').val('');
                                        $("input[name=bonus_percentage]").prop('disabled', false);
                                        $("#bonuspercentage").removeClass('d-none');
                                        $("#multientryteam").show();
                                    }
                                    if ($('input[name=is_bonus]').prop('checked') == false) {
                                        $("input[name=bonus_percentage]").prop('disabled', true);
                                        $("#bonuspercentage").addClass('d-none');
                                        $("#multientryteam").hide();
                                    }

                                });
                                $("input[name=contest_type]").change(function () {
                                    if ($('input[name=contest_type]:checked').val() == "Amount") {
                                        $('#pert').hide();
                                        $('#max_user').show();
                                        $("#ch1").prop('disabled', true);
                                    }
                                    if ($('input[name=contest_type]:checked').val() == "Percentage") {
                                        $('#pert').show();
                                        $('#max_user').hide();
                                        $("#ch1").prop('disabled', false);
                                    }
                                });
                                // $('input[name=multi_entry]').change(function () {
                                //     if ($('input[name=multi_entry]').prop('checked') == true) {
                                //         // $('input[name=team_limit]').val('');
                                //         $("input[name=team_limit]").prop('disabled', false);
                                //         $("#team_limit").stop().slideDown();
                                //     }
                                //     if ($('input[name=multi_entry]').prop('checked') == false) {
                                //         $("input[name=team_limit]").prop('disabled', true);
                                //         $("#team_limit").stop().slideUp();
                                //     }

                                // });
                            </script>
                            <script type="text/javascript">
                                $("input[name=contest_type]").change(function () {
                                    if ($('input[name=contest_type]:checked').val() == "Amount") {
                                        $('#pricecard_contest').show();
                                        document.getElementById("pricecard_contest").style.display = "block";
                                    }
                                    if ($('input[name=contest_type]:checked').val() == "Percentage") {
                                        $('#pricecard_contest').hide();
                                        document.getElementById("pricecard_contest").style.display = "none";
                                    }
                                });
                                $("input[name=pricecard_type]").change(function () {
                                    if ($('input[name=pricecard_type]:checked').val() == "Percentage") {
                                        $('#cc').hide();
                                        $('input[name=confirmed_challenge]').prop('checked', true);
                                    }
                                    else {
                                        $('#cc').show();
                                        $('input[name=confirmed_challenge]').prop('checked', false);
                                    }
                                });

                                function get_contest_category(value) {
                                    var fantasy_type = value;
                                    $.ajax({
                                        type: 'POST',
                                        url: '/get_contest_category',
                                        data: '_token=bTSsGdX3Z7uY7ptNccCMCJoz3YhMPTf56lRtKWSE&fantasy_type=' + fantasy_type,
                                        success: function (data) {
                                            $('#contest_cat').html('<option value="">Select Contest Category</option>');

                                            for (var i = 0; i < data.length; i++) {
                                                // alert(data[i]['id']);
                                                $('#contest_cat').append('<option value="' + data[i]['id'] + '">' + data[i]['name'] + '</option>');
                                            }

                                            // <option value="">Select Team</option>
                                        }
                                    });
                                }
                                $(window).ready(function () {
                                    var fantasy_type = $('#fantasy_type').val();
                                    get_contest_category(fantasy_type);
                                });
                            </script>
                        </div>
                </main>

                <%- include("../../partials/footer") %>
                    <script>

                        $(window).on('load', function () {

                            $('#preloader_admin').hide();

                        })
                    </script>

                    <script>

                        $('#special').on('click', function () {
                            mySelect.find('option:selected').prop('disabled', true);
                            mySelect.selectpicker('refresh');
                        });

                        $('#special2').on('click', function () {
                            mySelect.find('option:disabled').prop('disabled', false);
                            mySelect.selectpicker('refresh');
                        });

                        $('#basic2').selectpicker({
                            liveSearch: true,
                            maxOptions: 1
                        });
                    </script>



                    <script>
                        $(document).ready(function () {

                            if ($('#accordionSidenavPages a').hasClass('active')) {
                                $('#accordionSidenavPages a.active').parent().parent().prev('a').removeClass('collapsed');
                                $('#accordionSidenavPages a.active').parent().parent().addClass('show');
                                // console.log(id);
                            } else {
                                $('#takeonebar').addClass('slamdown');
                            }
                        });

                    </script>

                    <script>
                        function readURL(input) {
                            if (input.files && input.files[0]) {
                                var reader = new FileReader();
                                reader.onload = function (e) {
                                    $('#' + input.id + '-imagePreview').css('background-image', 'url(' + e.target.result + ')');
                                    $('#' + input.id + '-imagePreview').hide();
                                    $('#' + input.id + '-imagePreview').fadeIn(650);
                                }
                                reader.readAsDataURL(input.files[0]);
                            }
                        }
                        $(".imageUpload").change(function () {
                            readURL(this);
                        });
                    </script>

                    <script>
                        function isNumberKey(evt) {
                            //var e = evt || window.event;

                            var charCode = (evt.which) ? evt.which : evt.keyCode
                            if (charCode != 46 && charCode > 31
                                && (charCode < 48 || charCode > 57))

                                return false;
                            else {
                                var itemdecimal = evt.srcElement.value.split('.');
                                if (itemdecimal.length > 1 && charCode == 46)
                                    return false;

                                return true;
                            }
                        }

                    </script>




                    <script>
                        /*jslint browser:true*/
                        /*global jQuery, document*/

                        jQuery(document).ready(function () {
                            'use strict';

                            jQuery('#example-datetime-local-input, #example-datetime-local-input2, #start_date, #end_date, #dob-date, #expire_date').datetimepicker();
                        });
                    </script>